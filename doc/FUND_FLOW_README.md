# 资金流向功能使用说明

## 功能简介

stock-go已经成功集成了AKShare的资金流向数据，为自选列表添加了以下数据字段：

- **主力净流入** - 主力资金净流入净额，自动显示单位（万/亿）
- **超大单** - 超大单净流入（≥50万股或100万元），自动显示单位（万/亿）
- **大单** - 大单净流入（≥10万股or20万元），自动显示单位（万/亿）  
- **中单** - 中单净流入（≥2万股或4万元），自动显示单位（万/亿）
- **小单** - 小单净流入（<2万股或4万元），自动显示单位（万/亿）
- **净流入占比** - 主力资金净流入占比（%）

## 数据来源

- 使用AKShare库获取实时资金流向数据
- 数据来源准确，更新及时
- 支持沪深两市A股股票

## 界面展示

自选列表现在包含18列数据：
1. 光标列
2. 标签
3. 代码  
4. 名称
5. 现价
6. 昨收价
7. 开盘
8. 最高
9. 最低
10. 今日涨幅
11. 换手率
12. 成交量
13. **主力净流入** ✨ 新增
14. **超大单** ✨ 新增  
15. **大单** ✨ 新增
16. **中单** ✨ 新增
17. **小单** ✨ 新增
18. **净流入占比** ✨ 新增

## 数据解读

### 正负值含义
- **正值（红色显示）**：资金流入，表示买盘力量强
- **负值（绿色显示）**：资金流出，表示卖盘力量强  
- **零值（白色显示）**：资金流入流出平衡

### 数据分析要点
1. **主力净流入** = 超大单净流入 + 大单净流入
2. **净流入占比**反映主力资金相对强度
3. **超大单**通常代表机构资金动向
4. **小单**主要反映散户资金流向

## 技术实现

### 后端架构（异步优化版）
```
Go主程序 -> 异步任务调度 -> Python脚本 -> AKShare库 -> 缓存更新 -> 界面刷新
```

### 异步优化特性
- **非阻塞获取**：资金流向数据异步获取，不影响价格数据实时刷新
- **智能缓存**：内存缓存机制，避免重复请求相同数据
- **分批处理**：每个股票间隔200ms获取，避免API限制
- **1分钟更新**：资金流向数据每1分钟自动更新一次
- **实时显示**：每只股票获取完成后立即更新显示

### 关键文件
- `scripts/akshare_fund_flow.py` - AKShare数据获取脚本
- `venv/` - Python虚拟环境
- `main.go` - 主程序，包含资金流向数据结构和显示逻辑

### 数据结构
```go
type FundFlow struct {
    MainNetInflow       float64 // 主力净流入净额
    SuperLargeNetInflow float64 // 超大单净流入
    LargeNetInflow      float64 // 大单净流入
    MediumNetInflow     float64 // 中单净流入  
    SmallNetInflow      float64 // 小单净流入
    NetInflowRatio      float64 // 净流入占比
    ActiveBuyAmount     float64 // 主动买入金额
    ActiveSellAmount    float64 // 主动卖出金额
}

type FundFlowCacheEntry struct {
    Data        FundFlow  // 资金流向数据
    UpdateTime  time.Time // 数据更新时间
    IsUpdating  bool      // 是否正在更新中
}
```

## 使用方法

1. 进入自选列表查看模式
2. 所有中国A股股票将自动显示资金流向数据
3. 数据会随价格数据实时更新
4. 使用颜色区分资金流入流出情况

## 单位显示规则

系统会根据金额大小自动选择合适的单位：

- **1亿元以上**：显示为亿元（如：-2.76亿）
- **1亿元以下**：显示为万元（如：-3543.6万）
- **小于1000元**：显示为0
- **支持中英文**：中文显示"万/亿"，英文显示"W/B"

## 示例数据

```
股票: 贵州茅台 (SH600519)
主力净流入: -2.76亿       (资金大幅流出)
超大单: -1.06亿          (机构大幅减仓)  
大单: -1.69亿            (大户减仓)
中单: +2.76亿            (中等资金流入)
小单: -22.0万            (散户小幅流出)
净流入占比: -6.20%       (主力资金流出占比)
```

## 性能优化

### v2.0 异步优化版本特点：
- ✅ **界面不卡顿**：价格数据实时刷新不受资金流向获取影响
- ✅ **智能调度**：每个股票间隔200ms获取，遵守API限制
- ✅ **缓存机制**：避免重复请求，提升响应速度
- ✅ **增量更新**：每只股票获取完成后立即显示
- ✅ **定时更新**：资金流向数据每1分钟自动更新

### 与v1.0同步版本对比：
| 特性 | v1.0同步版本 | v2.0异步版本 |
|-----|------------|------------|
| 界面响应 | ❌ 获取期间卡顿 | ✅ 始终流畅 |
| 数据更新 | ❌ 全部获取完才显示 | ✅ 逐个完成立即显示 |
| 内存使用 | ❌ 每次重新获取 | ✅ 缓存复用 |
| API请求 | ❌ 可能触发限制 | ✅ 智能调度 |
| 用户体验 | ❌ 等待时间长 | ✅ 体验流畅 |

## 注意事项

1. 资金流向数据仅适用于中国A股市场
2. 数据获取需要网络连接
3. 首次获取时可能需要等待几秒钟
4. 异步获取过程中界面保持响应，不会卡顿

## 故障排除

如果资金流向数据显示为0或获取失败：
1. 检查网络连接
2. 确认Python虚拟环境正常
3. 验证AKShare库安装完整
4. 查看调试日志获取详细错误信息