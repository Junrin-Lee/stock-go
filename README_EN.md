# Stock Monitor System | è‚¡ç¥¨ç›‘æŽ§ç³»ç»Ÿ

> ðŸ¤– **AI Generated Repository**: This entire project was generated by AI, including code architecture, implementation, and documentation.

ðŸ“– **Language**: [ä¸­æ–‡](README.md) | [English](README_EN.md)

A modern command-line stock monitoring tool built with Go, featuring a smooth terminal interface powered by the Bubble Tea framework.

## Features

âœ… **Modern Interactive Interface**
- Responsive terminal interface built with Bubble Tea framework
- Real-time keyboard monitoring without confirmation prompts
- Smooth menu navigation and state transitions
- Support for arrow keys, WASD, and vim-style navigation

âœ… **Portfolio Management**
- View stock list: Real-time price fetching with detailed display of today's change, daily P&L, total P&L, P&L rate, and market value
- Add/remove stocks to/from portfolio
- Edit stocks: Modify cost price and quantity of existing stocks through interactive interface
- Automatic stock name retrieval - just input code, cost, and quantity
- 3-decimal precision for price display
- Persistent local data storage

âœ… **Real-time Monitoring**  
- 5-second interval real-time price updates
- Display current price, open price, high price, and low price
- Real-time today's change calculation: based on opening price fluctuation
- Calculate daily profit/loss and total profit/loss
- Show profit rate and market value

âœ… **Professional Table Display**
- Professional table layout using go-pretty library
- Perfect Chinese character width alignment
- Smart color system: Red for profit/gain, green for loss/decline, white for neutral (0 values)
- Stock separators for improved readability
- 13-column detailed data: Code, Name, Price, Open, High, Low, Cost, Quantity, Today's Change, Daily P&L, Total P&L, P&L Rate, Market Value

## Usage

### 1. Build the Program
```bash
go build -o stock-go main.go
```

### 2. Run the Program
```bash
./stock-go
```

### 3. Operating Instructions

**Keyboard Controls**:
- `â†‘â†“ Arrow Keys` or `W/S/J/K` - Navigate menu items
- `Enter` or `Space` - Confirm selection
- `ESC` or `Q` - Exit current interface/program
- `Ctrl+C` - Force quit program

**Main Menu Options:**
- `â–º View Stock List` - View detailed information of monitored stocks (with real-time P&L data)
- `  Add Stock` - Add new stock to portfolio
- `  Edit Stock` - Modify cost price and quantity of existing stocks
- `  Remove Stock` - Remove stock from portfolio  
- `  Start Monitoring` - Launch real-time monitoring
- `  Debug Mode: Off` - Toggle debug information display
- `  Exit` - Save and exit program

**View Stock List:**
1. Use arrow keys to select "View Stock List" and press Enter
2. System fetches real-time prices and displays detailed table containing: Serial Number, Stock Code, Stock Name, Current Price, Cost Price, Quantity, Today's Change, Daily P&L, Total P&L, P&L Rate, Market Value
3. Smart color display: Red for profit/gain, green for loss/decline, white for neutral
4. Shows portfolio summary data: Total Daily P&L, Total P&L, Total P&L Rate, Total Market Value
5. Press ESC or Q to return to main menu

**Add Stock (Real-time Input):**
1. Use arrow keys to select "Add Stock" and press Enter
2. Type stock code in real-time (e.g., SH601138, AAPL, TSLA)
3. Press Enter to automatically fetch stock name and current price (3 decimals)
4. Type purchase cost price in real-time, press Enter to confirm
5. Type quantity in real-time, press Enter to complete addition
6. Press ESC or Q to return to main menu anytime

**Edit Stock:**
1. Use arrow keys to select "Edit Stock" and press Enter
2. Use arrow keys to select the stock to modify (shows current cost price and quantity)
3. Press Enter to confirm selection and enter cost price modification
4. Type new cost price in real-time, press Enter to confirm
5. Type new quantity in real-time, press Enter to complete modification
6. System automatically saves changes and returns to main menu
7. Press ESC or Q to return to main menu anytime

**Remove Stock:**
1. Use arrow keys to select stock to remove
2. Press Enter to confirm deletion
3. Press ESC or Q to return to main menu

**Start Monitoring:**
1. Use arrow keys to select "Start Monitoring" and press Enter
2. System updates data every 5 seconds automatically
3. 13-column detailed display: Stock Code, Name, Price, Open, High, Low, Cost, Quantity, Today's Change, Daily P&L, Total P&L, P&L Rate, Market Value
4. Today's change calculated based on opening price: (Current Price - Open Price) / Open Price Ã— 100%
5. Smart color system:
   - Red: Profit/gain values (> 0.001)
   - Green: Loss/decline values (< -0.001)
   - White: Neutral values (â‰ˆ 0), such as 0% today's change, $0 daily P&L, etc.
6. Press ESC or Q to return to main menu

**Debug Mode:**
- Debug information is disabled in Bubble Tea mode (for clean interface)
- For debugging, check API request and response logs

## Stock Code Formats

The system supports multiple input formats and automatically converts to correct API format:

- **US Stocks:** Direct stock codes like AAPL, TSLA, MSFT
- **A-Shares:** Support multiple formats
  - `SH601138` or `601138` â†’ Auto-convert to `601138.SS` (Shanghai Stock Exchange)
  - `SZ000001` or `000001` â†’ Auto-convert to `000001.SZ` (Shenzhen Stock Exchange)
  - Direct standard format: `601138.SS`, `000001.SZ`
- **Hong Kong Stocks:** 
  - `HK0700` â†’ Auto-convert to `0700.HK`
  - Direct standard format: `0700.HK`

## Data Sources

Multi-source data strategy ensures reliability:

**Primary Sources** (by priority):
1. **Tencent Finance API** - Primary source for Chinese stocks (A-shares), provides complete data including open, high, low prices
2. **Finnhub API** - Primary source for US stocks and international markets
3. **Mock Data** - Provides complete demo data including open, high, low prices when all APIs are unavailable

**Backup Sources**:
- Alpha Vantage API
- Yahoo Finance API (backup)

**API Advantages**:
- Multiple backups ensure high data acquisition success rate
- Use most suitable data source for different markets
- Automatic failover mechanism

## File Description

- `main.go` - Main program file
- `portfolio.json` - Portfolio data file (auto-generated)
- `stock-go` - Compiled executable file

## Technical Architecture

**Core Frameworks:**
- **Bubble Tea**: Modern terminal user interface framework
- **Go-Pretty**: Professional table layout library with Chinese character alignment support
- **Golang Text**: Character encoding conversion (GBK to UTF-8)

**Dependencies:**
```bash
go mod download
# Main dependencies:
# - github.com/charmbracelet/bubbletea v1.3.6
# - github.com/jedib0t/go-pretty/v6 v6.6.8  
# - golang.org/x/text v0.28.0
```

## System Requirements

- Go 1.18 or higher
- Internet connection (for fetching stock data)
- Windows, macOS, Linux support
- Color-capable terminal (recommended)

## Troubleshooting

If encountering stock data showing as 0 or unable to fetch:

1. **Enable debug mode**: Select main menu option 4 (debug info disabled in Bubble Tea mode for clean interface)
2. **Check stock code format**: Ensure correct format (like SH601138, AAPL, etc.)
3. **Check network connection**: Ensure access to Tencent Finance API and Finnhub API
4. **Verify stock code validity**: Confirm stock code exists and format is correct
5. **Retry mechanism**: If encountering API limits, wait a few minutes and retry

## Common Issues

**Interface Related:**
- **Chinese character alignment issues**: Solved using go-pretty library for proper Chinese character width calculation
- **Color display problems**: Ensure terminal supports ANSI color codes
- **Color display logic**: Red for profit/gain, green for loss/decline, white for neutral (0 values)
- **Keyboard response delay**: Bubble Tea framework provides real-time response without confirmation waiting

**Data Fetching:**
- **Frequent API requests**: System has 5-second update interval to avoid frequent requests
- **Price showing as 0**: May be due to incorrect stock code format or network connection issues
- **Chinese stock name garbled text**: Implemented GBK to UTF-8 conversion, automatically handles encoding issues
- **API failures**: System automatically generates mock data for demonstration

## Changelog

**v2.4 - Stock Editing & Enhanced Stock List View**
- âœ… New stock editing feature: Modify cost price and quantity of existing stocks through interactive interface
- âœ… Enhanced stock list view: Real-time price fetching with display of today's change, daily P&L, total P&L, P&L rate, and market value
- âœ… Unified color display logic: Stock list view uses same color scheme as monitoring interface
- âœ… Portfolio summary: Stock list view shows overall P&L statistics at bottom
- âœ… Interaction optimization: Pre-fill current values when editing stocks for better user experience

**v2.3 - Smart Color Display System**
- âœ… Smart color judgment: Each value determines color based on its own value
- âœ… White neutral display: Zero values shown in white (e.g., 0% today's change, $0 daily P&L)
- âœ… Precise floating-point comparison: Uses epsilon values to avoid precision issues
- âœ… Professional stock software color standards: Red up, green down, white flat

**v2.2 - Stock Monitoring Data Enhancement**
- âœ… Added open price, high price, low price display
- âœ… Real-time today's change calculation: based on opening price fluctuation
- âœ… Upgraded monitoring table to 13-column detailed data display
- âœ… Optimized table column order: Today's change positioned left of daily P&L
- âœ… Tencent API and mock data support complete price data

**v2.1 - Stock List View Feature**
- âœ… Added stock list view function with table display of stock basic information
- âœ… Display serial number, stock code, stock name, quantity, cost price
- âœ… Portfolio statistics information display
- âœ… Optimized main menu structure and user interaction experience

**v2.0 - Bubble Tea Refactored Version**
- âœ… Integrated Bubble Tea framework for modern terminal interface
- âœ… Real-time keyboard response without confirmation prompts
- âœ… Used go-pretty library to solve Chinese character alignment issues
- âœ… Added profit/loss color display (red for profit, green for loss)
- âœ… Enhanced price display precision to 3 decimal places
- âœ… Stock separators for improved table readability

**v1.0 - Base Version**
- âœ… Multi-API data sources (Tencent Finance, Finnhub, Mock Data)
- âœ… Chinese stock name GBK encoding conversion
- âœ… Basic command-line interactive interface
- âœ… JSON data persistence storage

## Notes

1. **Modern Experience**: Smooth interaction based on Bubble Tea framework with real-time keyboard monitoring
2. **Data Precision**: Price display accurate to 3 decimal places for professional needs
3. **Chinese Support**: Perfect handling of Chinese character width and encoding conversion
4. **Color Display**: Profit/loss distinguished by colors for clear visualization
5. **Auto-save**: Portfolio data saved in real-time, retained after program restart
6. **Cross-platform**: Supports Windows, macOS, Linux systems
7. **Recommended Usage Time**: Use during market hours for most accurate real-time data