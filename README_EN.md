# Stock Monitor

> 🤖 **AI Generated Repository**: This entire project was generated by AI, including code architecture, implementation, and documentation.
---

📖 **Documentation**: [English](README_EN.md) | [中文](README.md)

## 🌟 Project Overview

Stock Monitor is a command-line terminal stock monitoring tool designed for investors.

### 🎯 Core Features

- **🔄 Real-time Monitoring** - 5-second interval automatic price refresh, capture every trading moment
- **📊 Professional Analysis** - 13-column detailed data display including OHLC, P&L analysis, and market value statistics
- **🎨 Smart Display** - Professional stock software color standards: red for gains, green for losses, white for neutral
- **💼 Portfolio Management** - Complete position management with add, edit, and delete stock operations
- **🌐 Global Markets** - Support for A-shares, US stocks, Hong Kong stocks and other major market code formats
- **💾 Data Persistence** - Local JSON storage, investment portfolio data is never lost

## ✨ Features

### 📱 Modern Interactive Interface
- Responsive terminal UI built with Bubble Tea framework
- Real-time keyboard response without waiting for confirmation
- Smooth state transitions and menu navigation
- Support for arrow keys, WASD, and Vim-style shortcuts

### 📈 Real-time Data Monitoring
- **Auto Updates**: Refresh stock price data every 5 seconds
- **Multi-dimensional Data**: Current price, open price, high price, low price, previous close
- **Change Analysis**: Precise change percentage based on previous close
- **P&L Statistics**: Real-time calculation of daily P&L, total P&L, and P&L rate

### 💼 Portfolio Management
- **Stock Search**: Support code or Chinese name search for stock information
- **Position Management**: Add, edit, delete stocks in investment portfolio
- **Cost Tracking**: Record purchase cost price and share quantity
- **Auto Calculation**: Real-time calculation of market value, P&L and other key metrics

### 🎨 Professional Data Display
- Professional table layout using go-pretty library
- Perfect Chinese character width alignment
- Smart color system: red (profit/gain), green (loss/decline), white (neutral)
- 13-column detailed data display covering all key investment indicators

## 🚀 Quick Start

### 📦 Requirements

- **Go Version**: 1.18 or higher
- **Network Connection**: For fetching real-time stock data
- **System Support**: Windows, macOS, Linux
- **Terminal**: Color display support (recommended)

### ⚡ Installation & Setup

#### 1️⃣ Clone Repository
```bash
git clone <repository-url>
cd stock-go
```

#### 2️⃣ Install Dependencies
```bash
go mod download
```

#### 3️⃣ Build Program
```bash
go build -o stock-go main.go
```

#### 4️⃣ Run Program
```bash
./stock-go
```

### 🎮 User Guide

#### ⌨️ Keyboard Shortcuts
- **Navigation**: `↑↓` Arrow keys or `W/S` or `J/K` (Vim style)
- **Confirm**: `Enter` or `Space` key
- **Return**: `ESC` or `Q` key
- **Force Quit**: `Ctrl+C`

#### 🏠 Main Menu Navigation
```
=== Stock Monitor System ===

► Stock List        # Enter real-time monitoring
  Stock Search      # Search stock information
  Add Stock         # Add new investment
  Edit Stock        # Edit position info
  Remove Stock      # Remove investment
  Debug Mode: Off   # Toggle debug info
  Exit             # Save and exit
```

#### 💡 Smart Startup
- **With Portfolio Data**: Program automatically enters monitoring mode
- **No Portfolio Data**: Shows main menu, guides user to add stocks

## 📊 Features Overview

### 📈 Real-time Monitoring Interface

Once in monitoring mode, the system displays professional stock data tables:

=== Real-time Stock Monitor ===
Update Time(5s): 2024-01-01 15:30:25

| Code | Name | Price | PrevClose | Open | High | Low | Cost | Quantity | Today% | DailyP&L | TotalP&L | P&LRate | Value |
|------|------|-------|-----------|------|------|-----|------|----------|--------|----------|----------|---------|-------|
| SH601138 | Industrial | 61.900 | 59.040 | 58.880 | 63.100 | 58.030 | 47.963 | 400 | +4.84% | +1144.00 | +5574.80 | +29.19% | 24760.00 |

ESC, Q or M to return to main menu

**Table Features**:
- **Smart Colors**: Red for profit/gains, green for loss/declines, white for neutral
- **Real-time Updates**: Automatically refresh latest stock data every 5 seconds
- **Precise Calculations**: All P&L data calculated accurately based on real-time prices
- **Summary Statistics**: Bottom shows overall portfolio P&L status

### 🔍 Stock Search Function

Support multiple search methods:

```
=== Stock Search ===

Enter stock code or name: Apple_

Supported formats:
• Chinese names: 贵州茅台, 苹果, 腾讯, 阿里巴巴, etc.
• Chinese stocks: SH601138, 000001, SZ000002, etc.
• US stocks: AAPL, TSLA, MSFT, etc.
• Hong Kong stocks: HK00700, etc.
```

### ➕ Add Stock Workflow

**Step 1**: Enter stock code
```
=== Add Stock ===

Enter stock code: SH601138_
Supported formats: SH601138, 000001, AAPL, etc.
```

**Step 2**: Confirm stock information
```
Stock Code: SH601138
Stock Name: Industrial Fulian
Current Price: 61.900

Enter cost price: 47.963_
```

**Step 3**: Enter share quantity
```
Stock Code: SH601138
Stock Name: Industrial Fulian
Current Price: 61.900
Cost Price: 47.963

Enter quantity: 400_
```

### ✏️ Edit Position Information

Select stock to modify, system guides through cost price and quantity updates:

```
=== Edit Stock ===

Select stock to edit:

► 1. Industrial Fulian (SH601138) - Cost: 47.963, Quantity: 400
  2. Hang Seng Tech ETF (SH513180) - Cost: 0.510, Quantity: 10000

Use arrow keys to select, Enter to confirm, ESC or Q to return
```

## 🌐 Supported Stock Markets

### 📍 Stock Code Formats

System intelligently recognizes and supports global mainstream stock markets:

| Market | Supported Format | Examples | Auto Conversion |
|--------|------------------|----------|----------------|
| 🇨🇳 **A-Share Shanghai** | `SH + 6 digits` or `6 digits` | `SH601138`, `601138` | `→ 601138.SS` |
| 🇨🇳 **A-Share Shenzhen** | `SZ + 6 digits` or `6 digits` | `SZ000001`, `000001` | `→ 000001.SZ` |
| 🇺🇸 **US Stocks** | Direct stock codes | `AAPL`, `TSLA`, `MSFT` | No conversion needed |
| 🇭🇰 **Hong Kong Stocks** | `HK + 5 digits` or standard format | `HK00700`, `0700.HK` | `→ 0700.HK` |

### 💡 Chinese Name Search

System supports using Chinese names to search stocks:

```
Chinese Input → Auto Match
Apple        → AAPL
Tesla        → TSLA  
Tencent      → 00700.HK
Maotai       → SH600519
```

## 📡 Data Sources & APIs

### 🎯 Multi-tier Data Strategy

System adopts multi-source + automatic fault tolerance mechanism to ensure data acquisition reliability:

```
Stock Code → [Chinese Stock?] → [Tencent API] → [Success?] → Return Data
                    │              │           │
                    ↓              ↓           ↓ Failed
                [Finnhub API] → [Success?] → [Mock Data] → Return Data
```

### 📊 Data Source Details

| Priority | API Name | Applicable Markets | Data Completeness | Update Frequency |
|:--------:|----------|-------------------|-------------------|------------------|
| 🥇 **1** | **Tencent API** | 🇨🇳 A-Share Markets | Complete (OHLC) | Real-time |
| 🥈 **2** | **Finnhub API** | 🇺🇸 US / 🇭🇰 HK Markets | Basic Data | Real-time |
| 🥉 **3** | **Mock Data** | All Markets | Complete Demo Data | Real-time Generated |

### 🔄 Fault Tolerance

- **Auto Retry**: Automatically try next data source when API fails
- **Smart Selection**: Choose optimal data source based on stock type
- **Fallback Guarantee**: Ultimately provide mock data to ensure program availability

## 📁 Project Structure

```
stock-go/
│
├── main.go              # 🚀 Main program file (contains all logic)
├── go.mod               # 📦 Go module dependencies
├── go.sum               # 🔒 Dependency version lock file
│
├── portfolio.json       # 📊 Portfolio data (auto-generated)
├── stock-go             # ⚙️ Compiled executable
│
├── README.md            # 📝 Chinese documentation
└── README_EN.md         # 📝 English documentation
```

### 💾 Data Storage

**portfolio.json** example:
```json
{
  "stocks": [
    {
      "code": "SH601138",
      "name": "Industrial Fulian",
      "cost_price": 47.963,
      "quantity": 400,
      "price": 61.9,
      "change": 2.86,
      "change_percent": 4.84
    }
  ]
}
```

## 🏭 Technical Architecture

### 🔧 Core Technology Stack

```
🖥️ User Interface ← Bubble Tea Framework
     │
     ├─ 📋 Data Display ← Go-Pretty Table Library
     │
     ├─ 📡 Data Fetching ← HTTP Client + Encoding Conversion
     │
     └─ 💾 Data Storage ← JSON Files
```

### 📦 Dependency Details

| Component | Version | Function | Advantages |
|-----------|---------|----------|------------|
| **Bubble Tea** | `v1.3.6` | Terminal UI Framework | • Responsive interaction<br>• Real-time event handling<br>• Modern experience |
| **Go-Pretty** | `v6.6.8` | Table Layout Library | • Chinese character alignment<br>• Rich style support<br>• Out-of-the-box |
| **Golang Text** | `v0.28.0` | Encoding Conversion | • GBK to UTF-8<br>• Multi-language support<br>• Official library |

### ⚙️ Install Dependencies

```bash
# Auto download all dependencies
go mod download

# Or manually install core dependencies
go get github.com/charmbracelet/bubbletea@v1.3.6
go get github.com/jedib0t/go-pretty/v6@v6.6.8
go get golang.org/x/text@v0.28.0
```

## System Requirements

- Go 1.18 or higher
- Internet connection (for fetching stock data)
- Windows, macOS, Linux support
- Color-capable terminal (recommended)

## 🔧 Troubleshooting

### ⚠️ Common Issues & Solutions

| Issue | Possible Causes | Solutions |
|-------|----------------|----------|
| 🚫 Stock data shows 0 | • Wrong stock code<br>• Network issues<br>• API limits | • Check code format<br>• Check network connection<br>• Retry later |
| 🎨 Color display issues | • Terminal doesn't support colors<br>• ANSI code issues | • Use color-capable terminal<br>• Check terminal settings |
| 🔤 Chinese text garbled | • Encoding issues<br>• Font not supported | • System handles automatically<br>• Check terminal font |
| ⏱️ Response delay | • Slow network connection<br>• Slow API response | • Check network status<br>• Switch network environment |

### 🔍 Debug Mode

Enable "Debug Mode" in main menu to get more detailed error information:

```
=== Stock Monitor System ===

  Stock List
  Stock Search
  Add Stock
  Edit Stock
  Remove Stock
► Debug Mode: On    # Click to toggle
  Exit
```

### 📞 Getting Help

If you encounter issues you can't solve, please provide:

- ⚙️ Operating system version
- 🚀 Go language version
- 📄 Error log screenshots
- 🌐 Network environment description
- 💰 Related stock codes

## 🌟 Special Features

### 🎨 Smart Color System

System adopts professional stock software color standards:

- 🔴 **Red**: Profit/gain values (> 0.001)
- 🟢 **Green**: Loss/decline values (< -0.001)
- ⚪ **White**: Neutral values (≈ 0), such as 0% change, $0 P&L

### 🕰️ Real-time Update Mechanism

- **Update Frequency**: Auto refresh every 5 seconds
- **Smart Caching**: Avoid frequent API requests
- **Fault Tolerance**: Auto fallback when API fails

### 📊 Precise Calculations

- **Today's Change**: Based on previous close `(Current Price - Previous Close) / Previous Close × 100%`
- **P&L Statistics**: Real-time calculation of daily P&L, total P&L, P&L rate
- **Market Value**: Current Price × Share Quantity

## 📈 Version History

### 🎉 v2.5 - Interface Logic Optimization 🆕

**New Features**:
- ✨ **Smart Startup**: Auto-enter monitoring mode when portfolio data exists
- 🎯 **One-click Access**: Main menu "Stock List" directly enters real-time monitoring
- ⏪ **Multi-key Return**: Support ESC, Q, M keys for multiple return methods

**Experience Improvements**:
- 🧹 **Streamlined Menu**: Remove duplicate functions, cleaner menu
- 💬 **Message Management**: Fix persistent success message issues

---

### 📅 Historical Versions

<details>
<summary>🔽 Click to view more version info</summary>

**v2.4 - Stock Editing & Enhanced Stock List View**
- ✅ New stock editing feature: Modify cost price and quantity of existing stocks through interactive interface
- ✅ Enhanced stock list view: Real-time price fetching with display of today's change, daily P&L, total P&L, P&L rate, and market value
- ✅ Unified color display logic: Stock list view uses same color scheme as monitoring interface
- ✅ Portfolio summary: Stock list view shows overall P&L statistics at bottom
- ✅ Interaction optimization: Pre-fill current values when editing stocks for better user experience

**v2.3 - Smart Color Display System**
- ✅ Smart color judgment: Each value determines color based on its own value
- ✅ White neutral display: Zero values shown in white (e.g., 0% today's change, $0 daily P&L)
- ✅ Precise floating-point comparison: Uses epsilon values to avoid precision issues
- ✅ Professional stock software color standards: Red up, green down, white flat

**v2.2 - Stock Monitoring Data Enhancement**
- ✅ Added open price, high price, low price display
- ✅ Real-time today's change calculation: based on previous close fluctuation
- ✅ Upgraded monitoring table to 13-column detailed data display
- ✅ Optimized table column order: Today's change positioned left of daily P&L
- ✅ Tencent API and mock data support complete price data

**v2.1 - Stock List View Feature**
- ✅ Added stock list view function with table display of stock basic information
- ✅ Display serial number, stock code, stock name, quantity, cost price
- ✅ Portfolio statistics information display
- ✅ Optimized main menu structure and user interaction experience

**v2.0 - Bubble Tea Refactored Version**
- ✅ Integrated Bubble Tea framework for modern terminal interface
- ✅ Real-time keyboard response without confirmation prompts
- ✅ Used go-pretty library to solve Chinese character alignment issues
- ✅ Added profit/loss color display (red for profit, green for loss)
- ✅ Enhanced price display precision to 3 decimal places
- ✅ Stock separators for improved table readability

**v1.0 - Base Version**
- ✅ Multi-API data sources (Tencent Finance, Finnhub, Mock Data)
- ✅ Chinese stock name GBK encoding conversion
- ✅ Basic command-line interactive interface
- ✅ JSON data persistence storage

</details>

## 📝 Usage Notes

### ✨ Product Highlights

- 🎮 **Modern Experience**: Smooth terminal interface built with Bubble Tea framework
- 🔍 **Precise Data**: 3 decimal precision, professional-grade data display
- 🌏 **Global Support**: Complete coverage of A-shares, US stocks, Hong Kong stocks
- 💾 **Data Persistence**: Local JSON storage, never lose data
- 🌈 **Smart Display**: Professional stock software color scheme

### 📅 Optimal Usage Times

| Time Period | Market Status | Data Quality |
|-------------|---------------|-------------|
| **09:30-15:00** | 🟢 A-Share Trading Hours | ⭐⭐⭐⭐⭐ Real-time Data |
| **21:30-04:00** | 🇺🇸 US Trading Hours | ⭐⭐⭐⭐⭐ Real-time Data |
| **Non-trading Hours** | 🔴 Market Closed | ⭐⭐⭐ Previous Close Price |

### 🚀 Quick Start Guide

1. **First Time Use**: Enter main menu directly, add some stocks first
2. **After Adding**: Program auto-enters monitoring mode on restart
3. **Daily Use**: View real-time data directly, adjust positions when needed

---

> 📝 **Friendly Reminder**: Please use during trading hours for most accurate data. Non-trading hours display the last trading price.