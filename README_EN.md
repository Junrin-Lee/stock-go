# Stock Monitor - Stock Monitoring System

[![Version](https://img.shields.io/badge/version-v5.7-blue.svg)]()
[![Go](https://img.shields.io/badge/Go-1.25+-00ADD8.svg)]()
[![Platform](https://img.shields.io/badge/platform-macOS%20%7C%20Linux%20%7C%20Windows-lightgrey.svg)]()

> **AI Generated Repository**: This entire project was generated by AI, including code architecture, implementation, and documentation.

**Documentation**: [English](README_EN.md) | [ä¸­æ–‡](README.md)

A professional command-line stock monitoring tool built with the Bubble Tea framework for a modern terminal UI. Supports real-time tracking of A-shares, US stocks, and Hong Kong stocks with portfolio management.

---

## Table of Contents

- [Features](#-features)
- [Quick Start](#-quick-start)
- [Screenshots](#-screenshots)
- [Keyboard Shortcuts](#-keyboard-shortcuts)
- [Architecture](#-architecture)
- [Project Structure](#-project-structure)
- [Configuration](#-configuration)
- [Supported Markets & APIs](#-supported-markets--apis)
- [Troubleshooting](#-troubleshooting)
- [Version History](#-version-history)
- [Usage Tips](#-usage-tips)

---

## Features

### Core Features

| Feature | Description |
|---------|-------------|
| **Real-time Monitoring** | Auto-refresh stock prices every 5 seconds, capture every trading moment |
| **Portfolio Management** | Complete position management with add, edit, delete operations |
| **Watchlist** | Independent stock watch list with multi-tag grouping and portfolio highlighting |
| **Intraday Charts** | View intraday price charts in terminal using Braille character rendering |
| **Multi-Tag Management** | Watchlist stocks support multiple tags for flexible grouping |
| **Global Markets** | Support for A-shares, US stocks, Hong Kong stocks code formats |
| **Multi-language** | Complete Chinese and English bilingual interface |
| **Data Persistence** | Local JSON storage, portfolio data never lost |

### Interface Features

- **Modern Interaction**: Responsive terminal UI built with Bubble Tea framework
- **Professional Colors**: Red for gains, green for losses, white for neutral (Chinese standard)
- **Smart Sorting**: Sort by 11 fields (portfolio) / 7 fields (watchlist)
- **Pagination**: Configurable rows per page to fit different screens
- **Vim Style**: Support arrow keys, WASD, J/K navigation

### Data Features

- **Multi-dimensional Data**: Current price, open, high, low, previous close, change %
- **P&L Statistics**: Real-time calculation of today's P&L, position P&L, P&L rate
- **Intraday Collection**: Background automatic collection of intraday data, updated every minute
- **Smart Caching**: 30-second TTL cache to avoid frequent API requests

---

## Quick Start

### Requirements

- **Go Version**: 1.25.0 or higher
- **Network Connection**: For fetching real-time stock data
- **System Support**: Windows, macOS, Linux
- **Terminal**: Color display support (recommended)

### Installation

```bash
# 1. Clone the repository
git clone <repository-url>
cd stock-monitor

# 2. Install dependencies
go mod download

# 3. Build the program
go build -o cmd/stock-monitor

# 4. Run the program
./cmd/stock-monitor
```

### First Run

- **No portfolio data**: Program shows main menu, guides user to add stocks
- **With portfolio data**: Program automatically enters monitoring mode

---

## Screenshots

### Portfolio View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Real-time Monitoring - Portfolio                          Auto-refresh: 5s    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Code   â”‚   Name   â”‚ Price  â”‚  Cost  â”‚  Qty   â”‚Today %  â”‚Position PLâ”‚ PL Rate â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SH601138 â”‚ Ind.Fox  â”‚  61.63 â”‚  51.98 â”‚   500  â”‚  -2.91% â”‚  +4,825  â”‚ +18.6%  â”‚
â”‚ SZ000001 â”‚ Ping An  â”‚  12.45 â”‚  11.20 â”‚  1000  â”‚  +1.22% â”‚  +1,250  â”‚ +11.2%  â”‚
â”‚ AAPL     â”‚ Apple    â”‚ 189.95 â”‚ 175.00 â”‚   100  â”‚  +0.85% â”‚  +1,495  â”‚  +8.5%  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              Total P&L: +7,570  |  Total Value: Â¥62,705
```

### Watchlist View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Watchlist                                       Tag Filter: All | Auto: 5s    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Tag    â”‚   Code   â”‚   Name   â”‚ Price  â”‚Today %  â”‚Turnover â”‚ Volume â”‚  High  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Liquor   â”‚ SH600519 â”‚ Moutai   â”‚1668.00 â”‚  +1.25% â”‚  0.35%  â”‚  3.2M  â”‚1680.00 â”‚
â”‚ Tech     â”‚ SZ000725 â”‚ BOE      â”‚   4.52 â”‚  -0.88% â”‚  1.82%  â”‚  1.5B  â”‚   4.58 â”‚
â”‚ EV       â”‚ SZ002594 â”‚ BYD      â”‚ 238.50 â”‚  +2.15% â”‚  0.95%  â”‚  280M  â”‚ 241.00 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Intraday Chart

Press `V` key to view the intraday chart for the selected stock:

```
   SPDB (SH600000) - 2025-12-02

   8.60 â”¤
        â”‚         â  â Šâ ‘â ¢â¡€
   8.55 â”¤     â ”â       â ‘â¢„â  â ”â Šâ ¢â¡€
        â”‚  â¡ â Š            â ‘â¢„   â ‘â ¢â¡€
   8.50 â”¼â ”â                   â ‘â ¤â£€â ”â Šâ ‘â ¢â£€
        â”‚
   8.45 â”¤
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         09:30     10:30     11:30   13:00   14:00   15:00

   Prev Close: 8.48  |  Open: 8.52  |  High: 8.58  |  Low: 8.45
```

---

## Keyboard Shortcuts

### General Shortcuts

| Key | Function |
|-----|----------|
| `â†‘` `â†“` or `W` `S` or `J` `K` | Navigate up/down |
| `Enter` or `Space` | Confirm selection |
| `ESC` or `Q` | Go back |
| `Ctrl+C` | Force quit |

### Input Box Editing

| Key | Function |
|-----|----------|
| `â†` `â†’` | Move cursor |
| `Backspace` | Delete character before cursor |
| `Delete` | Delete character after cursor |

### Portfolio Specific

| Key | Function |
|-----|----------|
| `A` | Add new stock (go to search) |
| `E` | Edit selected stock |
| `D` | Delete selected stock |
| `S` | Enter sort settings |
| `V` | View intraday chart |

### Watchlist Specific

| Key | Function |
|-----|----------|
| `A` | Add stock to watchlist |
| `D` | Delete selected stock |
| `T` | Tag management (add/delete/edit) |
| `G` | View by tag groups |
| `C` | Clear tag filter |
| `S` | Enter sort settings |
| `V` | View intraday chart |

### Sort Menu

| Key | Function |
|-----|----------|
| `â†‘` `â†“` | Select sort field |
| `Enter` | Apply sort/toggle order |
| `C` | Clear sort |

---

## Architecture

### Layered Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Layer                                 â”‚
â”‚          Bubble Tea Framework + Go-Pretty Tables            â”‚
â”‚              main.go | ui_utils.go | format.go              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Business Logic Layer                        â”‚
â”‚           State Machine + Feature Modules                   â”‚
â”‚         watchlist.go | intraday_chart.go | sort.go          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Data Layer                               â”‚
â”‚              Cache + Persistence + Types                    â”‚
â”‚          cache.go | persistence.go | types.go               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               External Integration Layer                    â”‚
â”‚               Multi-API with Fallback                       â”‚
â”‚                api.go | intraday.go                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                Cross-Cutting Concerns                       â”‚
â”‚          i18n.go | debug.go | color.go | consts.go          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Core Modules

| Module | Lines | Responsibility | Description |
|--------|:-----:|----------------|-------------|
| `main.go` | 3,156 | State Machine & Event Handling | Core app logic, 19 states, Bubble Tea event loop |
| `api.go` | 1,226 | API Integration | Multi-source data fetching with auto fallback |
| `intraday_chart.go` | 754 | Intraday Charts | Braille rendering, smart date selection, adaptive Y-axis |
| `intraday.go` | 616 | Intraday Collection | Background worker pool (max 10 concurrent), per-minute updates |
| `watchlist.go` | 508 | Watchlist Management | Multi-tag operations, filtering, grouping, search |
| `sort.go` | 238 | Sorting Engine | 11 portfolio fields + 7 watchlist fields sorting |
| `types.go` | 215 | Data Structures | Stock, StockData, Config and other core types |
| `persistence.go` | 171 | Data Persistence | JSON/YAML read/write, backup restore |
| `cache.go` | 129 | Price Cache | 30-second TTL, RWMutex concurrent protection |
| `ui_utils.go` | 194 | UI Utilities | Table formatting, Chinese width handling, pagination |

### Technology Stack

| Component | Version | Purpose |
|-----------|---------|---------|
| **Bubble Tea** | v1.3.6 | Terminal UI framework, responsive interaction |
| **Go-Pretty** | v6.6.8 | Table layout, Chinese character alignment |
| **ntcharts** | v0.3.1 | Braille character chart rendering |
| **golang.org/x/text** | v0.28.0 | GBK/UTF-8 encoding conversion |
| **YAML v3** | v3.0.1 | Configuration file handling |

---

## Project Structure

```
stock-monitor/
â”œâ”€â”€ main.go                 # Core app: state machine, event handling (3,156 lines)
â”œâ”€â”€ api.go                  # API integration: multi-source with fallback (1,226 lines)
â”œâ”€â”€ intraday_chart.go       # Intraday charts: Braille rendering (754 lines)
â”œâ”€â”€ intraday.go             # Intraday collection: background worker pool (616 lines)
â”œâ”€â”€ watchlist.go            # Watchlist management: tags, groups (508 lines)
â”œâ”€â”€ sort.go                 # Sorting engine (238 lines)
â”œâ”€â”€ types.go                # Data structure definitions (215 lines)
â”œâ”€â”€ ui_utils.go             # UI utility functions (194 lines)
â”œâ”€â”€ persistence.go          # Data persistence (171 lines)
â”œâ”€â”€ format.go               # Formatting utilities (156 lines)
â”œâ”€â”€ debug.go                # Debug logging (153 lines)
â”œâ”€â”€ cache.go                # Price caching (129 lines)
â”œâ”€â”€ scroll.go               # Scroll handling (77 lines)
â”œâ”€â”€ consts.go               # Constants (71 lines)
â”œâ”€â”€ i18n.go                 # Internationalization (57 lines)
â”œâ”€â”€ color.go                # Color utilities (55 lines)
â”œâ”€â”€ go.mod / go.sum         # Go module dependencies
â”‚
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ stock-monitor       # Compiled executable
â”‚   â””â”€â”€ conf/
â”‚       â”œâ”€â”€ config.yml      # User config file (auto-generated)
â”‚       â””â”€â”€ config_demo.yaml # Config template (bilingual comments)
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ portfolio.json      # Portfolio data
â”‚   â”œâ”€â”€ watchlist.json      # Watchlist data
â”‚   â””â”€â”€ intraday/           # Intraday data directory
â”‚       â”œâ”€â”€ SH600000/       # Organized by stock code
â”‚       â”‚   â”œâ”€â”€ 20251202.json
â”‚       â”‚   â””â”€â”€ 20251203.json
â”‚       â””â”€â”€ SZ000001/
â”‚           â””â”€â”€ 20251202.json
â”‚
â”œâ”€â”€ i18n/
â”‚   â”œâ”€â”€ zh.json             # Chinese language pack (~250 strings)
â”‚   â””â”€â”€ en.json             # English language pack (~250 strings)
â”‚
â”œâ”€â”€ doc/
â”‚   â”œâ”€â”€ version/            # Version history documentation
â”‚   â””â”€â”€ issues/             # Feature documentation
â”‚
â”œâ”€â”€ README.md               # Chinese documentation
â””â”€â”€ README_EN.md            # English documentation
```

---

## Configuration

### Config File Location

`cmd/conf/config.yml` - Auto-created on first run

### Configuration Options

| Setting | Default | Description | Options |
|---------|---------|-------------|---------|
| `system.language` | `zh` | System language | `zh`, `en` |
| `system.auto_start` | `true` | Auto enter monitoring with data | `true`, `false` |
| `system.startup_module` | `portfolio` | Startup module | `portfolio`, `watchlist` |
| `system.debug_mode` | `false` | Debug mode | `true`, `false` |
| `display.color_scheme` | `professional` | Color scheme | `professional`, `simple` |
| `display.decimal_places` | `3` | Price decimals | `1-4` |
| `display.table_style` | `light` | Table style | `light`, `bold`, `simple` |
| `display.max_lines` | `10` | Rows per page | Any positive integer |
| `display.portfolio_highlight` | `yellow` | Portfolio highlight color | `black`, `red`, `green`, `yellow`, `blue`, `magenta`, `cyan`, `white` |
| `update.refresh_interval` | `5` | Refresh interval (sec) | Any positive integer |
| `update.auto_update` | `true` | Auto refresh | `true`, `false` |

### Config File Example

```yaml
system:
    language: en
    auto_start: true
    startup_module: portfolio
    debug_mode: false

display:
    color_scheme: professional
    decimal_places: 3
    table_style: light
    max_lines: 10
    portfolio_highlight: yellow

update:
    refresh_interval: 5
    auto_update: true
```

### v5.2 New Feature: Configurable Table Columns

v5.2 introduces a flexible table column configuration system, allowing users to customize displayed columns and their order.

#### Portfolio Configurable Columns (14 Columns)

**Required Columns** (cannot be removed):
- `cursor` - Selection cursor indicator
- `code` - Stock code
- `name` - Stock name
- `price` - Current price

**Optional Columns** (can be enabled/disabled):
- `prev_close` - Previous close
- `open` - Open price
- `high` - High price
- `low` - Low price
- `cost` - Cost price
- `quantity` - Quantity held
- `today_change` - Today's change %
- `position_profit` - Position P&L
- `profit_rate` - P&L rate
- `market_value` - Market value

#### Watchlist Configurable Columns (12 Columns)

**Required Columns** (cannot be removed):
- `cursor` - Selection cursor indicator
- `tag` - Tag
- `code` - Stock code
- `name` - Stock name
- `price` - Current price

**Optional Columns** (can be enabled/disabled):
- `prev_close` - Previous close
- `open` - Open price
- `high` - High price
- `low` - Low price
- `today_change` - Today's change %
- `turnover` - Turnover rate
- `volume` - Volume

#### Configuration Examples

**Minimal Mode** (essential info only):
```yaml
display:
  portfolio_columns:
    - cursor
    - code
    - name
    - price
    - position_profit
    - profit_rate

  watchlist_columns:
    - cursor
    - tag
    - code
    - name
    - price
    - today_change
```

**Custom Priority Mode** (P&L first):
```yaml
display:
  portfolio_columns:
    - cursor
    - code
    - name
    - price
    - position_profit     # Prioritize P&L
    - profit_rate         # Prioritize P&L rate
    - cost
    - quantity
    - today_change
    - market_value
```

**Detailed Mode** (all columns, default):
```yaml
display:
  portfolio_columns:
    - cursor
    - code
    - name
    - prev_close
    - open
    - high
    - low
    - price
    - cost
    - quantity
    - today_change
    - position_profit
    - profit_rate
    - market_value

  watchlist_columns:
    - cursor
    - tag
    - code
    - name
    - price
    - prev_close
    - open
    - high
    - low
    - today_change
    - turnover
    - volume
```

**Usage Tips**:
- Columns display left-to-right in configured order
- Comment out a line to hide that column (except required columns)
- Required columns are automatically added if missing
- Restart application after config changes to take effect

#### Intraday Collection Configuration (v5.3+)

v5.3 introduces an intelligent intraday data collection system with customizable settings.

**Default Configuration (Recommended)**:
```yaml
intraday_collection:
  enable_auto_stop: true            # Enable smart auto-stop
  completeness_threshold: 90.0      # Completeness threshold (percentage)
  max_consecutive_errors: 5         # Max consecutive errors before stopping
  min_datapoints: 20                # Minimum datapoints for completeness
```

**Configuration Parameters**:

| Parameter | Meaning | Default | Range | Description |
|-----------|---------|---------|-------|-------------|
| `enable_auto_stop` | Enable auto-stop | true | true/false | When false, workers run continuously |
| `completeness_threshold` | Completeness threshold | 90.0 | 50.0-100.0 | Percentage at which data is considered complete |
| `max_consecutive_errors` | Max consecutive errors | 5 | 1-20 | Stop worker after this many consecutive failures |
| `min_datapoints` | Minimum datapoints | 20 | 10-100 | Minimum datapoints required to judge completeness |

**Scenario-Based Configurations**:

**Low Network Bandwidth**:
```yaml
intraday_collection:
  enable_auto_stop: true
  completeness_threshold: 85.0      # Lower threshold for faster stopping
  max_consecutive_errors: 3         # Lower tolerance
  min_datapoints: 15
```

**Data Quality Priority**:
```yaml
intraday_collection:
  enable_auto_stop: true
  completeness_threshold: 95.0      # Higher threshold for completeness
  max_consecutive_errors: 10        # Higher tolerance
  min_datapoints: 50
```

---

## Supported Markets & APIs

### Stock Code Formats

| Market | Input Format | Examples | API Format |
|--------|--------------|----------|------------|
| **Shanghai A-Share** | `SH + 6 digits` or `6 digits` | `SH601138`, `601138` | `601138.SS` |
| **Shenzhen A-Share** | `SZ + 6 digits` or `6 digits` | `SZ000001`, `000001` | `000001.SZ` |
| **US Stocks** | Stock symbol | `AAPL`, `TSLA`, `MSFT` | Direct use |
| **Hong Kong Stocks** | `HK + 5 digits` or standard | `HK00700`, `0700.HK` | `0700.HK` |

### Data Sources & APIs

| Priority | API | Markets | Purpose |
|:--------:|-----|---------|---------|
| 1 | **Tencent API** | A-Shares | Real-time quotes (primary) |
| 2 | **Sina API** | A-Shares | Real-time quotes (backup), intraday data (primary) |
| 3 | **East Money** | A-Shares/HK | Intraday data (backup), HK turnover rate |
| 4 | **Finnhub** | US/HK Stocks | Real-time quotes |
| 5 | **TwelveData** | US Stocks | Stock search (backup) |

### Fallback Mechanism

```
A-Share Real-time:  Tencent API â†’ Sina API â†’ Display "-"
Intraday Data:      Sina Finance â†’ East Money â†’ Skip
Stock Search:       Tencent Search â†’ Sina Search â†’ TwelveData â†’ Not Found
```

- **Auto Retry**: Automatically try next data source on failure
- **Smart Selection**: Choose optimal data source based on stock type
- **Graceful Failure**: Display "-" when data unavailable, program continues

---

## Troubleshooting

### Common Issues

| Issue | Possible Causes | Solutions |
|-------|-----------------|-----------|
| Stock data shows "-" | Network / API error / Invalid code | Check network, verify code |
| Color display issues | Terminal doesn't support ANSI | Use color-capable terminal |
| Chinese text garbled | Encoding/font issues | Check terminal font settings |
| Response delay | Slow network / Slow API | Check network environment |

### Debug Mode

1. Enable "Debug Mode" in main menu
2. Press `D` key in monitoring view to see debug logs
3. Logs show API call details and error information

### Getting Help

If you encounter issues, please provide:
- Operating system version
- Go language version
- Error log screenshots
- Related stock codes

---

## Version History

### Current Version - v5.7 (December 2025)

**ðŸ·ï¸ Watchlist Tag Grouping System**

- **Tag Group Display**: Clear separation of market groups and user-defined tags with grouped UI design
- **Position Memory**: Remember last selected tag and quickly return to previous position
- **Boundary Stop**: List stops at top/bottom edges, no circular scrolling for better navigation
- **Visual Optimization**: Clear group separators for improved readability
- **Complete Bilingual Support**: Full Chinese and English support
- **Full Backward Compatibility**: Fully compatible with v5.6 and earlier versions

### Version History

| Version | Release Date | Major Updates | Documentation |
|---------|--------------|-----------------|----------------|
| **v5.7** | Dec 2025 | ðŸ·ï¸ Watchlist tag grouping system, position memory, boundary stop | [Details](doc/changelogs/v5.7.md) |
| v5.6 | Dec 2025 | ðŸ” Search view enhancement, real-time intraday charts, auto-refresh | [Details](doc/changelogs/v5.6.md) |
| v5.5 | Dec 2025 | ðŸ·ï¸ Watchlist market tag system, auto data migration | [Details](doc/changelogs/v5.5.md) |
| v5.4 | Dec 2025 | ðŸ”§ HK turnover rate fix, East Money API integration | [Details](doc/changelogs/v5.4.md) |
| v5.3 | Dec 2025 | ðŸ›¡ï¸ Critical fixes, intelligent worker system, multi-market timezone enhancements | [Details](doc/changelogs/v5.3.md) |
| v5.2 | Dec 2025 | ðŸ“Š Configurable table columns, flexible config, UX upgrades | [Details](doc/changelogs/v5.2.md) |
| v5.1 | Dec 2025 | ðŸŒ Multi-market support, US/HK intraday data, Yahoo API, unit tests | [Details](doc/changelogs/v5.1.md) |
| v5.0 | Dec 2025 | ðŸ—ï¸ Architecture modernization, complete modular design | [Details](doc/changelogs/v5.0.md) |
| v4.9 | Nov 2025 | Intraday chart enhancement, smart date selection | [Details](doc/changelogs/v4.9.md) |
| v4.8 | Nov 2025 | Multi-tag system, UX optimization | [Details](doc/changelogs/v4.8.md) |
| v4.7 | Oct 2025 | Architecture optimization, i18n enhancement | [Details](doc/changelogs/v4.7.md) |
| v4.6 | Oct 2025 | Intraday data collection, async optimization | [Details](doc/changelogs/v4.6.md) |
| v4.5 | Sep 2025 | Advanced sorting system | [Details](doc/changelogs/v4.5.md) |

View complete version history: [doc/version/](doc/changelogs/)

---

## Usage Tips

### Optimal Trading Hours

| Time Period | Market Status | Data Quality |
|-------------|---------------|--------------|
| 09:30-15:00 | A-Share Trading | Real-time Data |
| 21:30-04:00 | US Market Trading | Real-time Data |
| Non-trading | Market Closed | Previous Close |

### Efficient Operations

- **Batch Management**: Use watchlist to follow multiple stocks, then selectively add to portfolio
- **Multi-Tag Grouping**: Add multiple tags to watchlist stocks (e.g., "Tech", "Healthcare") for flexible categorization
- **Sorting Analysis**: Use sorting function to analyze performance by P&L rate, change %, etc.
- **Portfolio Recognition**: Notice highlighted portfolio stocks in watchlist
- **Intraday Charts**: Press `V` key to quickly view stock intraday trends

### Configuration Optimization

- Adjust `display.max_lines` based on screen size
- Tune `update.refresh_interval` to balance real-time updates and network load
- Use `display.portfolio_highlight` to customize portfolio highlight color

---

> **Note**: Please use during trading hours for most accurate data. Non-trading hours display the last trading price. This tool is for investment reference only. Investment involves risks, please invest carefully.
