# Stock Monitor - Stock Monitoring System

[![Version](https://img.shields.io/badge/version-v5.1-blue.svg)]()
[![Go](https://img.shields.io/badge/Go-1.25+-00ADD8.svg)]()
[![Platform](https://img.shields.io/badge/platform-macOS%20%7C%20Linux%20%7C%20Windows-lightgrey.svg)]()

> **AI Generated Repository**: This entire project was generated by AI, including code architecture, implementation, and documentation.

**Documentation**: [English](README_EN.md) | [中文](README.md)

A professional command-line stock monitoring tool built with the Bubble Tea framework for a modern terminal UI. Supports real-time tracking of A-shares, US stocks, and Hong Kong stocks with portfolio management.

---

## Table of Contents

- [Features](#-features)
- [Quick Start](#-quick-start)
- [Screenshots](#-screenshots)
- [Keyboard Shortcuts](#-keyboard-shortcuts)
- [Architecture](#-architecture)
- [Project Structure](#-project-structure)
- [Configuration](#-configuration)
- [Supported Markets & APIs](#-supported-markets--apis)
- [Troubleshooting](#-troubleshooting)
- [Version History](#-version-history)
- [Usage Tips](#-usage-tips)

---

## Features

### Core Features

| Feature | Description |
|---------|-------------|
| **Real-time Monitoring** | Auto-refresh stock prices every 5 seconds, capture every trading moment |
| **Portfolio Management** | Complete position management with add, edit, delete operations |
| **Watchlist** | Independent stock watch list with multi-tag grouping and portfolio highlighting |
| **Intraday Charts** | View intraday price charts in terminal using Braille character rendering |
| **Multi-Tag Management** | Watchlist stocks support multiple tags for flexible grouping |
| **Global Markets** | Support for A-shares, US stocks, Hong Kong stocks code formats |
| **Multi-language** | Complete Chinese and English bilingual interface |
| **Data Persistence** | Local JSON storage, portfolio data never lost |

### Interface Features

- **Modern Interaction**: Responsive terminal UI built with Bubble Tea framework
- **Professional Colors**: Red for gains, green for losses, white for neutral (Chinese standard)
- **Smart Sorting**: Sort by 11 fields (portfolio) / 7 fields (watchlist)
- **Pagination**: Configurable rows per page to fit different screens
- **Vim Style**: Support arrow keys, WASD, J/K navigation

### Data Features

- **Multi-dimensional Data**: Current price, open, high, low, previous close, change %
- **P&L Statistics**: Real-time calculation of today's P&L, position P&L, P&L rate
- **Intraday Collection**: Background automatic collection of intraday data, updated every minute
- **Smart Caching**: 30-second TTL cache to avoid frequent API requests

---

## Quick Start

### Requirements

- **Go Version**: 1.25.0 or higher
- **Network Connection**: For fetching real-time stock data
- **System Support**: Windows, macOS, Linux
- **Terminal**: Color display support (recommended)

### Installation

```bash
# 1. Clone the repository
git clone <repository-url>
cd stock-go

# 2. Install dependencies
go mod download

# 3. Build the program
go build -o cmd/stock-monitor

# 4. Run the program
./cmd/stock-monitor
```

### First Run

- **No portfolio data**: Program shows main menu, guides user to add stocks
- **With portfolio data**: Program automatically enters monitoring mode

---

## Screenshots

### Portfolio View

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  Real-time Monitoring - Portfolio                          Auto-refresh: 5s    │
├──────────┬──────────┬────────┬────────┬────────┬─────────┬──────────┬─────────┤
│   Code   │   Name   │ Price  │  Cost  │  Qty   │Today %  │Position PL│ PL Rate │
├──────────┼──────────┼────────┼────────┼────────┼─────────┼──────────┼─────────┤
│ SH601138 │ Ind.Fox  │  61.63 │  51.98 │   500  │  -2.91% │  +4,825  │ +18.6%  │
│ SZ000001 │ Ping An  │  12.45 │  11.20 │  1000  │  +1.22% │  +1,250  │ +11.2%  │
│ AAPL     │ Apple    │ 189.95 │ 175.00 │   100  │  +0.85% │  +1,495  │  +8.5%  │
└──────────┴──────────┴────────┴────────┴────────┴─────────┴──────────┴─────────┘
                              Total P&L: +7,570  |  Total Value: ¥62,705
```

### Watchlist View

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  Watchlist                                       Tag Filter: All | Auto: 5s    │
├──────────┬──────────┬──────────┬────────┬─────────┬─────────┬────────┬────────┤
│   Tag    │   Code   │   Name   │ Price  │Today %  │Turnover │ Volume │  High  │
├──────────┼──────────┼──────────┼────────┼─────────┼─────────┼────────┼────────┤
│ Liquor   │ SH600519 │ Moutai   │1668.00 │  +1.25% │  0.35%  │  3.2M  │1680.00 │
│ Tech     │ SZ000725 │ BOE      │   4.52 │  -0.88% │  1.82%  │  1.5B  │   4.58 │
│ EV       │ SZ002594 │ BYD      │ 238.50 │  +2.15% │  0.95%  │  280M  │ 241.00 │
└──────────┴──────────┴──────────┴────────┴─────────┴─────────┴────────┴────────┘
```

### Intraday Chart

Press `V` key to view the intraday chart for the selected stock:

```
   SPDB (SH600000) - 2025-12-02

   8.60 ┤
        │         ⠠⠊⠑⠢⡀
   8.55 ┤     ⠔⠁      ⠑⢄⠠⠔⠊⠢⡀
        │  ⡠⠊            ⠑⢄   ⠑⠢⡀
   8.50 ┼⠔⠁                  ⠑⠤⣀⠔⠊⠑⠢⣀
        │
   8.45 ┤
        └────────────────────────────────────────────
         09:30     10:30     11:30   13:00   14:00   15:00

   Prev Close: 8.48  |  Open: 8.52  |  High: 8.58  |  Low: 8.45
```

---

## Keyboard Shortcuts

### General Shortcuts

| Key | Function |
|-----|----------|
| `↑` `↓` or `W` `S` or `J` `K` | Navigate up/down |
| `Enter` or `Space` | Confirm selection |
| `ESC` or `Q` | Go back |
| `Ctrl+C` | Force quit |

### Input Box Editing

| Key | Function |
|-----|----------|
| `←` `→` | Move cursor |
| `Backspace` | Delete character before cursor |
| `Delete` | Delete character after cursor |

### Portfolio Specific

| Key | Function |
|-----|----------|
| `A` | Add new stock (go to search) |
| `E` | Edit selected stock |
| `D` | Delete selected stock |
| `S` | Enter sort settings |
| `V` | View intraday chart |

### Watchlist Specific

| Key | Function |
|-----|----------|
| `A` | Add stock to watchlist |
| `D` | Delete selected stock |
| `T` | Tag management (add/delete/edit) |
| `G` | View by tag groups |
| `C` | Clear tag filter |
| `S` | Enter sort settings |
| `V` | View intraday chart |

### Sort Menu

| Key | Function |
|-----|----------|
| `↑` `↓` | Select sort field |
| `Enter` | Apply sort/toggle order |
| `C` | Clear sort |

---

## Architecture

### Layered Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    UI Layer                                 │
│          Bubble Tea Framework + Go-Pretty Tables            │
│              main.go | ui_utils.go | format.go              │
├─────────────────────────────────────────────────────────────┤
│                 Business Logic Layer                        │
│           State Machine + Feature Modules                   │
│         watchlist.go | intraday_chart.go | sort.go          │
├─────────────────────────────────────────────────────────────┤
│                    Data Layer                               │
│              Cache + Persistence + Types                    │
│          cache.go | persistence.go | types.go               │
├─────────────────────────────────────────────────────────────┤
│               External Integration Layer                    │
│               Multi-API with Fallback                       │
│                api.go | intraday.go                         │
├─────────────────────────────────────────────────────────────┤
│                Cross-Cutting Concerns                       │
│          i18n.go | debug.go | color.go | consts.go          │
└─────────────────────────────────────────────────────────────┘
```

### Core Modules

| Module | Lines | Responsibility | Description |
|--------|:-----:|----------------|-------------|
| `main.go` | 3,156 | State Machine & Event Handling | Core app logic, 19 states, Bubble Tea event loop |
| `api.go` | 1,226 | API Integration | Multi-source data fetching with auto fallback |
| `intraday_chart.go` | 754 | Intraday Charts | Braille rendering, smart date selection, adaptive Y-axis |
| `intraday.go` | 616 | Intraday Collection | Background worker pool (max 10 concurrent), per-minute updates |
| `watchlist.go` | 508 | Watchlist Management | Multi-tag operations, filtering, grouping, search |
| `sort.go` | 238 | Sorting Engine | 11 portfolio fields + 7 watchlist fields sorting |
| `types.go` | 215 | Data Structures | Stock, StockData, Config and other core types |
| `persistence.go` | 171 | Data Persistence | JSON/YAML read/write, backup restore |
| `cache.go` | 129 | Price Cache | 30-second TTL, RWMutex concurrent protection |
| `ui_utils.go` | 194 | UI Utilities | Table formatting, Chinese width handling, pagination |

### Technology Stack

| Component | Version | Purpose |
|-----------|---------|---------|
| **Bubble Tea** | v1.3.6 | Terminal UI framework, responsive interaction |
| **Go-Pretty** | v6.6.8 | Table layout, Chinese character alignment |
| **ntcharts** | v0.3.1 | Braille character chart rendering |
| **golang.org/x/text** | v0.28.0 | GBK/UTF-8 encoding conversion |
| **YAML v3** | v3.0.1 | Configuration file handling |

---

## Project Structure

```
stock-go/
├── main.go                 # Core app: state machine, event handling (3,156 lines)
├── api.go                  # API integration: multi-source with fallback (1,226 lines)
├── intraday_chart.go       # Intraday charts: Braille rendering (754 lines)
├── intraday.go             # Intraday collection: background worker pool (616 lines)
├── watchlist.go            # Watchlist management: tags, groups (508 lines)
├── sort.go                 # Sorting engine (238 lines)
├── types.go                # Data structure definitions (215 lines)
├── ui_utils.go             # UI utility functions (194 lines)
├── persistence.go          # Data persistence (171 lines)
├── format.go               # Formatting utilities (156 lines)
├── debug.go                # Debug logging (153 lines)
├── cache.go                # Price caching (129 lines)
├── scroll.go               # Scroll handling (77 lines)
├── consts.go               # Constants (71 lines)
├── i18n.go                 # Internationalization (57 lines)
├── color.go                # Color utilities (55 lines)
├── go.mod / go.sum         # Go module dependencies
│
├── cmd/
│   ├── stock-monitor       # Compiled executable
│   └── conf/
│       ├── config.yml      # User config file (auto-generated)
│       └── config_demo.yaml # Config template (bilingual comments)
│
├── data/
│   ├── portfolio.json      # Portfolio data
│   ├── watchlist.json      # Watchlist data
│   └── intraday/           # Intraday data directory
│       ├── SH600000/       # Organized by stock code
│       │   ├── 20251202.json
│       │   └── 20251203.json
│       └── SZ000001/
│           └── 20251202.json
│
├── i18n/
│   ├── zh.json             # Chinese language pack (~250 strings)
│   └── en.json             # English language pack (~250 strings)
│
├── doc/
│   ├── version/            # Version history documentation
│   └── issues/             # Feature documentation
│
├── README.md               # Chinese documentation
└── README_EN.md            # English documentation
```

---

## Configuration

### Config File Location

`cmd/conf/config.yml` - Auto-created on first run

### Configuration Options

| Setting | Default | Description | Options |
|---------|---------|-------------|---------|
| `system.language` | `zh` | System language | `zh`, `en` |
| `system.auto_start` | `true` | Auto enter monitoring with data | `true`, `false` |
| `system.startup_module` | `portfolio` | Startup module | `portfolio`, `watchlist` |
| `system.debug_mode` | `false` | Debug mode | `true`, `false` |
| `display.color_scheme` | `professional` | Color scheme | `professional`, `simple` |
| `display.decimal_places` | `3` | Price decimals | `1-4` |
| `display.table_style` | `light` | Table style | `light`, `bold`, `simple` |
| `display.max_lines` | `10` | Rows per page | Any positive integer |
| `display.portfolio_highlight` | `yellow` | Portfolio highlight color | `black`, `red`, `green`, `yellow`, `blue`, `magenta`, `cyan`, `white` |
| `update.refresh_interval` | `5` | Refresh interval (sec) | Any positive integer |
| `update.auto_update` | `true` | Auto refresh | `true`, `false` |

### Config File Example

```yaml
system:
    language: en
    auto_start: true
    startup_module: portfolio
    debug_mode: false

display:
    color_scheme: professional
    decimal_places: 3
    table_style: light
    max_lines: 10
    portfolio_highlight: yellow

update:
    refresh_interval: 5
    auto_update: true
```

---

## Supported Markets & APIs

### Stock Code Formats

| Market | Input Format | Examples | API Format |
|--------|--------------|----------|------------|
| **Shanghai A-Share** | `SH + 6 digits` or `6 digits` | `SH601138`, `601138` | `601138.SS` |
| **Shenzhen A-Share** | `SZ + 6 digits` or `6 digits` | `SZ000001`, `000001` | `000001.SZ` |
| **US Stocks** | Stock symbol | `AAPL`, `TSLA`, `MSFT` | Direct use |
| **Hong Kong Stocks** | `HK + 5 digits` or standard | `HK00700`, `0700.HK` | `0700.HK` |

### Data Sources & APIs

| Priority | API | Markets | Purpose |
|:--------:|-----|---------|---------|
| 1 | **Tencent API** | A-Shares | Real-time quotes (primary) |
| 2 | **Sina API** | A-Shares | Real-time quotes (backup), intraday data (primary) |
| 3 | **East Money** | A-Shares | Intraday data (backup) |
| 4 | **Finnhub** | US/HK Stocks | Real-time quotes |
| 5 | **TwelveData** | US Stocks | Stock search (backup) |

### Fallback Mechanism

```
A-Share Real-time:  Tencent API → Sina API → Display "-"
Intraday Data:      Sina Finance → East Money → Skip
Stock Search:       Tencent Search → Sina Search → TwelveData → Not Found
```

- **Auto Retry**: Automatically try next data source on failure
- **Smart Selection**: Choose optimal data source based on stock type
- **Graceful Failure**: Display "-" when data unavailable, program continues

---

## Troubleshooting

### Common Issues

| Issue | Possible Causes | Solutions |
|-------|-----------------|-----------|
| Stock data shows "-" | Network / API error / Invalid code | Check network, verify code |
| Color display issues | Terminal doesn't support ANSI | Use color-capable terminal |
| Chinese text garbled | Encoding/font issues | Check terminal font settings |
| Response delay | Slow network / Slow API | Check network environment |

### Debug Mode

1. Enable "Debug Mode" in main menu
2. Press `D` key in monitoring view to see debug logs
3. Logs show API call details and error information

### Getting Help

If you encounter issues, please provide:
- Operating system version
- Go language version
- Error log screenshots
- Related stock codes

---

## Version History

### Current Version - v5.1

**Internationalization Enhancement & Hong Kong Stock Search Fix**

- **Hong Kong Stock Search Fix**: Fixed empty search results for Hong Kong stocks (e.g., HK00700)
- **Debug Log Internationalization**: All debug logs and internal messages support Chinese/English switching
- **Intraday Chart Internationalization**: Intraday chart interface fully supports multi-language display
- **Code Quality Improvement**: Optimized dependency management, cleaned up redundant modules

### Version History

| Version | Major Updates |
|---------|---------------|
| [v5.1](doc/version/v5.1.md) | Internationalization enhancement, HK stock search fix |
| [v5.0](doc/version/v5.0.md) | Architecture modernization, 16-module design |
| [v4.9](doc/version/v4.9.md) | Intraday chart enhancement, smart date selection |
| [v4.8](doc/version/v4.8.md) | Multi-tag system, UX optimization |
| [v4.7](doc/version/v4.7.md) | Architecture optimization, i18n enhancement |
| [v4.6](doc/version/v4.6.md) | Intraday data collection, async optimization |
| [v4.5](doc/version/v4.5.md) | Advanced sorting system |

View complete version history: [doc/version/](doc/version/)

---

## Usage Tips

### Optimal Trading Hours

| Time Period | Market Status | Data Quality |
|-------------|---------------|--------------|
| 09:30-15:00 | A-Share Trading | Real-time Data |
| 21:30-04:00 | US Market Trading | Real-time Data |
| Non-trading | Market Closed | Previous Close |

### Efficient Operations

- **Batch Management**: Use watchlist to follow multiple stocks, then selectively add to portfolio
- **Multi-Tag Grouping**: Add multiple tags to watchlist stocks (e.g., "Tech", "Healthcare") for flexible categorization
- **Sorting Analysis**: Use sorting function to analyze performance by P&L rate, change %, etc.
- **Portfolio Recognition**: Notice highlighted portfolio stocks in watchlist
- **Intraday Charts**: Press `V` key to quickly view stock intraday trends

### Configuration Optimization

- Adjust `display.max_lines` based on screen size
- Tune `update.refresh_interval` to balance real-time updates and network load
- Use `display.portfolio_highlight` to customize portfolio highlight color

---

> **Note**: Please use during trading hours for most accurate data. Non-trading hours display the last trading price. This tool is for investment reference only. Investment involves risks, please invest carefully.
